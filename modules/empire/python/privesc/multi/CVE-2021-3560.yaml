name: Polkit (CVE-2021-3560)
authors:
  - name: Anthony Rose
    handle: '@Cx01N'
    link: https://twitter.com/@Cx01N_
description: |
  Exploits CVE-2021-3560, a critical authentication bypass vulnerability in polkit
  (PolicyKit) that allows unprivileged users to call privileged methods via DBus
  without proper authentication. This module leverages the vulnerability to create
  a new privileged user account and gain root access on vulnerable Linux systems.

  The exploit works by:
  - Bypassing polkit's authentication mechanism through a race condition
  - Calling privileged DBus methods on the accounts service
  - Creating a new user with administrative privileges via CreateUser method
  - Setting a password for the new user via SetPassword method
  - Logging in as the newly created privileged user
  - Elevating to root privileges through the compromised account

  This vulnerability affects polkit versions prior to 0.119 and is particularly
  dangerous because it requires no user interaction and can be exploited remotely
  in certain configurations. The exploit terminates the existing agent and spawns
  a new high-integrity agent with root privileges, providing complete system access.

  The vulnerability was discovered by GitHub Security Lab and affects multiple
  Linux distributions including Ubuntu, Debian, and CentOS.
software: ''
tactics: []
techniques:
  - T1050
background: false
output_extension: ''
needs_admin: false
opsec_safe: true
language: python
min_language_version: '3'
comments:
  - https://github.com/Almorabea/Polkit-exploit
  - https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/
options:
  - name: Agent
    description: Agent to execute module on.
    required: true
    value: ''
  - name: Listener
    description: Listener to use.
    required: true
    value: ''
  - name: SafeChecks
    description: Enable SafeChecks.
    required: true
    value: 'True'
    strict: true
    suggested_values:
      - True
      - False
  - name: UserAgent
    description: User-agent string to use for the staging request (default, none,
      or other).
    required: false
    value: default
script_path: python/privesc/CVE-2021-3560.py
advanced:
  custom_generate: true
